# 压轴题

## 问题重述

在这个压轴题中，我们需要根据视频实现原神的开屏循环动画、登录系统、抽卡系统以及保底机制。下面将详细说明实现方案。

## 实现方案

为了实现这个系统，我们将采用Python面向对象编程，并将其分为客户端和服务端。我们将使用5000端口作为监听端口，使用HTTP协议进行通信，并遵循RESTful API设计规则。数据库部分我们将使用SQLite。

### 1. 开屏循环动画

在开屏循环动画部分，我们将采用字符画循环播放动画，直到用户输入。具体实现步骤如下：

- 在客户端启动时，请求服务器开始播放开屏动画。
- 服务器端将循环播放字符画动画，直到接收到客户端的终止请求。
- 当用户输入某个指令时，客户端向服务器发送请求，通知服务器停止播放动画。

### 2. 登录系统

登录系统将基于Flask和JWT（JSON Web Token）来实现。以下是详细步骤：

- 当客户端首次登录成功时，将向服务器请求一个JWT（用于身份验证），并将其保存在本地。
- JWT具有一定的有效期，一段时间后会过期，客户端需要重新登录以获取新的JWT。
- 客户端在每次请求需要身份验证的资源时，都要在请求中携带JWT以证明其身份。

### 3. 抽卡系统

抽卡系统将包括用户登录状态的检测以及抽卡次数的记录。以下是具体实现步骤：

- 当客户端调用抽卡方法时，首先会检测用户是否已登录。
- 如果用户已登录，客户端将向服务器发送抽卡请求。
- 服务器会生成抽卡结果，并将该用户当前的抽卡次数记录在数据库中。
- 另外，抽卡系统还应该包含保底机制，以确保玩家在一定次数内能够获得稀有物品。

通过以上实现方案，我们可以完成原神的开屏循环动画、登录系统、抽卡系统以及保底机制的功能。这将为玩家提供一个完整的游戏体验。

# 抽卡实现 - 原神UP池概率机制

在原神的抽卡系统中，根据抽卡次数 `draw_count` 直接计算出当前概率并抽卡，同时使用标志位来记录上次出现四星/五星的情况。五星标志位是一个数组，用于记录是否为UP角色。

函数的入口参数为：`(draw_count, 四星标志位, 五星标志位)`。以下是实现这样一个抽卡函数的详细说明：

### 原神UP池概率机制

原神的UP池概率机制如下：

- 在上次出现五星后的 `[1, 73]` 抽时，每次抽中五星角色的概率为 0.6%。
- 在上次出现五星后的 `[74, 90]` 抽中，每次抽卡的概率比上次高 6%。
- 当获取到五星角色时，有 50% 的概率是UP角色。如果这次五星没有抽到UP角色，下次五星角色必定是UP角色。
- 五星角色的保底为 90 抽，而五星UP角色的保底为 180 抽。
- 如果没有抽到五星，出现三星的概率是四星的六倍，每十抽必定产生一个四星。

### 抽卡函数返回值

该函数的返回值包括：

- 抽到的星数（三星、四星、五星等）
- 是否为UP角色
- 四星标志位
- 五星标志位

这个抽卡函数实现了原神UP池的概率机制，可以根据用户的抽卡次数和抽卡历史来计算出抽卡结果，确保了概率的准确性。
